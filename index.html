<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Formulario con Firma Digital - LemonadeJS</title>
    <script src="https://cdn.jsdelivr.net/npm/lemonadejs/dist/lemonade.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@lemonadejs/signature/dist/index.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f4f4f4;
        }

        form {
            background: #fff;
            padding: 20px;
            max-width: 600px;
            margin: auto;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            font-weight: bold;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        .signature-container {
            margin-top: 10px;
        }

        .button-group {
            margin-top: 15px;
        }

        .button-group input {
            margin-right: 10px;
            padding: 8px 16px;
            font-size: 14px;
        }

        img {
            margin-top: 15px;
            max-width: 100%;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>

<h2>Formulario con Firma Digital</h2>

<form id="formulario">
    <div class="form-group">
        <label for="nombre">Nombre completo:</label>
        <input type="text" id="nombre" name="nombre" required />
    </div>

    <div class="form-group">
        <label>Firma:</label>
        <div id="root" class="signature-container"></div>
    </div>

    <div class="button-group">
        <input type="button" value="Limpiar Firma" id="resetCanvas" />
        <input type="button" value="Guardar Firma" id="downloadImage" />
        <input type="submit" value="Enviar" />
    </div>

    <img id="image" alt="Vista previa de la firma" />
</form>

<script>
    const root = document.getElementById("root");
    const resetCanvas = document.getElementById("resetCanvas");
    const downloadImage = document.getElementById("downloadImage");
    const image = document.getElementById("image");
    const form = document.getElementById("formulario");

    // Inicializar componente de firma
    const component = Signature(root, {
        width: 500,
        height: 150,
        instructions: "Firme en el recuadro superior, por favor"
    });

    // Limpiar firma
    resetCanvas.addEventListener("click", () => {
        component.value = [];
        image.src = "";
    });

    // Descargar firma como imagen Base64
    downloadImage.addEventListener("click", () => {
        if (component.value.length === 0) {
            alert("Por favor, firme antes de descargar.");
            return;
        }

        const dataURL = component.getImage(); // Base64
        image.src = dataURL;

        // Crear enlace y descargar la imagen
        const link = document.createElement("a");
        link.href = dataURL;
        link.download = "firma.png"; // Nombre del archivo
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    });

    // Enviar formulario
    form.addEventListener("submit", function (e) {
        e.preventDefault();

        if (component.value.length === 0) {
            alert("Por favor, proporcione su firma antes de enviar.");
            return;
        }

        const nombre = document.getElementById("nombre").value;
        const firma = component.getImage(); // Base64 PNG

        console.log("Nombre:", nombre);
        console.log("Firma (Base64):", firma);

        alert("Formulario enviado correctamente. Revisa la consola para ver los datos.");
    });
</script>

</body>
</html>
